<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×¡×¤×¨×™×™×ª ×”×©×™×¢×•×¨×™×</title>
    <style>
        body { font-family: sans-serif; background: #f4f6f8; margin: 0; padding: 20px; }
        h1 { text-align: center; color: #333; }
        
        /* ×¢×™×¦×•×‘ ×”×ª×™×§×™×•×ª */
        .folder-box { margin-bottom: 10px; border: 1px solid #ddd; background: white; border-radius: 8px; overflow: hidden; }
        .folder-header { 
            padding: 15px; cursor: pointer; background: #fff; font-weight: bold; font-size: 1.1em;
            display: flex; justify-content: space-between; align-items: center;
        }
        .folder-header:hover { background: #f8f9fa; }
        .folder-header.nested { background: #f1f3f5; font-size: 1em; margin: 5px; border-radius: 5px; }
        .folder-content { display: none; padding: 10px; border-top: 1px solid #eee; }
        .show { display: block; }
        
        /* ×¢×™×¦×•×‘ ×”× ×’×Ÿ */
        .file-card { 
            background: #fff; border: 1px solid #e9ecef; padding: 15px; margin-bottom: 10px; 
            border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .file-title { font-weight: bold; margin-bottom: 10px; display: block; color: #0056b3; }
        .controls { margin-top: 10px; display: flex; gap: 10px; align-items: center; }
        .speed-btn { 
            background: white; border: 1px solid #ccc; padding: 5px 10px; cursor: pointer; border-radius: 4px; 
        }
        .speed-btn.active { background: #0056b3; color: white; border-color: #0056b3; }
        .resume-msg { font-size: 0.8em; color: green; margin-right: 10px; display: none; }
        
        /* ×”×•×“×¢×ª ×˜×¢×™× ×” */
        #loader { text-align: center; padding: 50px; font-size: 1.2em; color: #666; }
    </style>
</head>
<body>

    <h1>ğŸ“š ×××’×¨ ×”×©×™×¢×•×¨×™× ×”××¨×›×–×™</h1>
    
    <div id="loader">×˜×•×¢×Ÿ ××ª ×”×©×™×¢×•×¨×™× ××”×©×¨×ª... × × ×œ×”××ª×™×Ÿ.</div>
    <div id="library-root"></div>

<script>
    // --- ×”×’×“×¨×•×ª ×—×•×‘×”: ×©× ×” ××ª ×–×” ×œ×©× ×©×œ×š ---
    const USERNAME = 'dovi770'; 
    const REPO_NAME = 'meluket';    
    // --------------------------------------

    const apiUrl = `https://api.github.com/repos/${USERNAME}/${REPO_NAME}/releases?per_page=100`;

    // 1. ×©×œ×™×¤×ª ×”× ×ª×•× ×™×
    fetch(apiUrl)
    .then(res => res.json())
    .then(releases => {
        document.getElementById('loader').style.display = 'none';
        const fileTree = buildFileTree(releases);
        renderTree(fileTree, document.getElementById('library-root'));
    })
    .catch(err => {
        document.getElementById('loader').innerHTML = '×©×’×™××” ×‘×˜×¢×™× ×ª × ×ª×•× ×™×. ×•×•×“× ×©×©× ×”××©×ª××© ×•×”×××’×¨ × ×›×•× ×™× ×‘×§×•×“.';
        console.error(err);
    });

    // 2. ×‘× ×™×™×ª ×¢×¥ ×”×ª×™×§×™×•×ª
    function buildFileTree(releases) {
        const tree = {};
        releases.forEach(release => {
            // ×¤×™×¨×•×§ ×”×©× ×œ×¤×™ ××§×£ - ×”×˜×¨×™×§ ×©×™×•×¦×¨ ×ª×™×§×™×•×ª
            const parts = release.name.split(' - ').map(s => s.trim());
            let current = tree;
            
            parts.forEach((part, index) => {
                if (!current[part]) {
                    // ×× ×–×” ×”×—×œ×§ ×”××—×¨×•×Ÿ - ×–×” ×”×¨×™×œ×™×¡ ×¢× ×”×§×‘×¦×™×
                    if (index === parts.length - 1) {
                        current[part] = { type: 'files', data: release.assets };
                    } else {
                        // ×–×• ×ª×™×§×™×™×ª ×‘×™× ×™×™×
                        current[part] = { type: 'folder', children: {} };
                    }
                }
                if (index < parts.length - 1) current = current[part].children;
            });
        });
        return tree;
    }

    // 3. ×”×¦×’×ª ×”×¢×¥ (HTML)
    function renderTree(node, container) {
        for (const [key, value] of Object.entries(node)) {
            if (value.type === 'folder') {
                // ×™×¦×™×¨×ª ×ª×™×§×™×™×”
                const folderDiv = document.createElement('div');
                folderDiv.className = 'folder-box';
                folderDiv.innerHTML = `
                    <div class="folder-header" onclick="toggleFolder(this)">ğŸ“ ${key} <span>â–¼</span></div>
                    <div class="folder-content"></div>
                `;
                renderTree(value.children, folderDiv.querySelector('.folder-content'));
                container.appendChild(folderDiv);
            } else {
                // ×™×¦×™×¨×ª ×ª×™×§×™×™×ª ×”×§×¦×” ×¢× ×”×§×‘×¦×™×
                const endFolder = document.createElement('div');
                endFolder.className = 'folder-box';
                endFolder.innerHTML = `
                    <div class="folder-header nested" onclick="toggleFolder(this)">ğŸ“€ ${key} (${value.data.length}) <span>â–¼</span></div>
                    <div class="folder-content"></div>
                `;
                
                const filesContainer = endFolder.querySelector('.folder-content');
                value.data.forEach(file => {
                    if (file.name.match(/\.(mp3|m4a|wav|ogg)$/i)) {
                        createPlayer(file, filesContainer);
                    }
                });
                container.appendChild(endFolder);
            }
        }
    }

    function toggleFolder(element) {
        const content = element.nextElementSibling;
        content.classList.toggle('show');
        element.querySelector('span').innerText = content.classList.contains('show') ? 'â–²' : 'â–¼';
    }

    // 4. ×™×¦×™×¨×ª ×”× ×’×Ÿ ×”×—×›× (××”×™×¨×•×ª + ×–×™×›×¨×•×Ÿ)
    function createPlayer(file, container) {
        const cleanName = file.name.replace(/\.[^/.]+$/, "").replace(/_/g, " ");
        const uniqueId = `audio_${file.id}`; // ××–×”×” ×™×™×—×•×“×™ ×œ×©××™×¨×”
        
        const div = document.createElement('div');
        div.className = 'file-card';
        div.innerHTML = `
            <span class="file-title">ğŸµ ${cleanName}</span>
            <audio id="${uniqueId}" controls style="width:100%" preload="none">
                <source src="${file.browser_download_url}" type="audio/mpeg">
            </audio>
            <div class="controls">
                <button class="speed-btn active" onclick="setSpeed('${uniqueId}', 1, this)">x1</button>
                <button class="speed-btn" onclick="setSpeed('${uniqueId}', 1.25, this)">x1.25</button>
                <button class="speed-btn" onclick="setSpeed('${uniqueId}', 1.5, this)">x1.5</button>
                <button class="speed-btn" onclick="setSpeed('${uniqueId}', 2, this)">x2</button>
                <a href="${file.browser_download_url}" download style="margin-right:auto; text-decoration:none; color:#0056b3">â¬‡ ×”×•×¨×“×”</a>
                <span id="msg_${uniqueId}" class="resume-msg">×××©×™×š ××”×××¦×¢...</span>
            </div>
        `;
        container.appendChild(div);

        // ×œ×•×’×™×§×” ×©×œ ×©××™×¨×ª ××™×§×•×
        const audio = div.querySelector('audio');
        
        // ×‘×˜×¢×™× ×” - ×‘×“×•×§ ×× ×™×© ××™×§×•× ×©××•×¨
        audio.onloadedmetadata = () => {
            const saved = localStorage.getItem(uniqueId);
            if(saved && saved > 0) {
                audio.currentTime = saved;
                document.getElementById(`msg_${uniqueId}`).style.display = 'inline';
                setTimeout(() => document.getElementById(`msg_${uniqueId}`).style.display = 'none', 4000);
            }
        };

        // ×©××™×¨×” ×ª×•×š ×›×“×™ × ×™×’×•×Ÿ
        audio.ontimeupdate = () => {
            if(!audio.paused) localStorage.setItem(uniqueId, audio.currentTime);
        };
    }

    // ×¤×•× ×§×¦×™×™×ª ××”×™×¨×•×ª ×’×œ×•×‘×œ×™×ª
    window.setSpeed = function(id, rate, btn) {
        document.getElementById(id).playbackRate = rate;
        // ××™×¤×•×¡ ×›×¤×ª×•×¨×™×
        const allBtns = btn.parentElement.querySelectorAll('.speed-btn');
        allBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
    }
</script>

</body>
</html>
