<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×¤×¨×•×™×§×˜ ××œ×•×§×˜ - ×¡×¤×¨×™×™×ª ×”×©×™×¢×•×¨×™×</title>
    <!-- ×™×™×‘×•× ×¤×•× ×˜ Rubik ××’×•×’×œ -->
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #1a237e; /* ×›×—×•×œ ×¢××•×§ */
            --secondary-color: #f5f5f5;
            --accent-color: #c5a065; /* ×–×”×‘ ×¢×“×™×Ÿ */
            --text-color: #333;
            --bg-color: #f4f6f9;
            --card-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        body { 
            font-family: 'Rubik', sans-serif; 
            background: var(--bg-color); 
            margin: 0; 
            padding: 0; 
            color: var(--text-color);
            line-height: 1.6;
        }

        /* ×¢×™×¦×•×‘ ×”×›×•×ª×¨×ª ×”×¢×œ×™×•× ×” */
        header {
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
            color: white;
            padding: 40px 20px;
            text-align: center;
            border-radius: 0 0 30px 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            margin-bottom: 30px;
        }

        h1 { 
            margin: 0; 
            font-weight: 700; 
            font-size: 2.2em; 
            letter-spacing: -0.5px;
        }

        .subtitle {
            margin-top: 10px;
            font-size: 1.1em;
            opacity: 0.9;
            font-weight: 300;
            color: #e8eaf6;
        }

        /* ××™×›×œ ×”×ª×•×›×Ÿ */
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 15px 40px 15px;
        }

        /* ×× ×™××¦×™×™×ª ×˜×¢×™× ×” */
        #loader { 
            text-align: center; 
            padding: 50px; 
            font-size: 1.1em; 
            color: var(--primary-color);
            font-weight: 500;
        }

        /* ×¢×™×¦×•×‘ ×”×ª×™×§×™×•×ª */
        .folder-box { 
            margin-bottom: 15px; 
            border: none; 
            background: white; 
            border-radius: 12px; 
            box-shadow: var(--card-shadow);
            overflow: hidden;
            transition: transform 0.2s ease;
        }

        .folder-header { 
            padding: 18px 20px; 
            cursor: pointer; 
            background: white; 
            font-weight: 500; 
            font-size: 1.1em;
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            border-bottom: 1px solid transparent;
            transition: background 0.2s;
            color: var(--primary-color);
        }

        .folder-header:hover { 
            background: #f8f9fa; 
        }

        .folder-header span {
            color: #999;
            font-size: 0.8em;
        }

        /* ×ª×™×§×™×•×ª ×¤× ×™××™×•×ª */
        .folder-header.nested { 
            background: #fcfcfc; 
            font-size: 1em; 
            padding: 12px 20px;
            border-top: 1px solid #f0f0f0;
            color: #444;
        }
        
        .folder-content { 
            display: none; 
            background: #fafafa;
            animation: fadeIn 0.3s ease-in-out;
        }
        
        .show { display: block; }
        
        /* ×¢×™×¦×•×‘ ×”× ×’×Ÿ ×•×›×¨×˜×™×¡ ×”×§×•×‘×¥ */
        .file-card { 
            background: #fff; 
            border-top: 1px solid #eee; 
            padding: 20px; 
            position: relative;
        }

        .file-title { 
            font-weight: 600; 
            margin-bottom: 12px; 
            display: block; 
            color: #333;
            font-size: 1em;
        }

        audio {
            width: 100%;
            border-radius: 30px;
            margin-bottom: 15px;
            outline: none;
        }

        /* ×›×¤×ª×•×¨×™ ×©×œ×™×˜×” */
        .controls { 
            display: flex; 
            gap: 8px; 
            align-items: center; 
            flex-wrap: wrap;
        }

        .speed-btn { 
            background: #f0f2f5; 
            border: none; 
            padding: 6px 12px; 
            cursor: pointer; 
            border-radius: 20px; 
            font-size: 0.9em;
            font-weight: 500;
            color: #555;
            transition: all 0.2s;
        }

        .speed-btn:hover { background: #e0e0e0; }

        .speed-btn.active { 
            background: var(--primary-color); 
            color: white; 
            box-shadow: 0 2px 5px rgba(26, 35, 126, 0.3);
        }

        .download-btn {
            margin-right: auto; 
            text-decoration: none; 
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 500;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .download-btn:hover {
            background: var(--primary-color);
            color: white;
        }

        .resume-msg { 
            font-size: 0.8em; 
            color: #2e7d32; 
            background: #e8f5e9;
            padding: 4px 10px;
            border-radius: 4px;
            display: none; 
            font-weight: 500;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ×”×ª×××” ×œ× ×™×™×“ */
        @media (max-width: 600px) {
            h1 { font-size: 1.8em; }
            .folder-header { padding: 15px; }
            .controls { gap: 5px; }
            .speed-btn { padding: 5px 10px; font-size: 0.85em; }
        }
    </style>
</head>
<body>

<header>
    <h1>×¤×¨×•×™×§×˜ ××œ×•×§×˜</h1>
    <div class="subtitle">×©×™×¢×•×¨×™× ×‘×¡×¤×¨ ×”××××¨×™× ××œ×•×§×˜ ××¤×™ ×˜×•×‘×™ ×”××©×¤×™×¢×™×</div>
</header>

<div class="container">
    <div id="loader">
        ğŸ”„ ×˜×•×¢×Ÿ ××ª ×××’×¨ ×”×©×™×¢×•×¨×™×...
    </div>
    <div id="library-root"></div>
</div>

<script>
    // --- ×”×’×“×¨×•×ª ×—×•×‘×”: ×•×•×“× ×©×–×” ×ª×•×× ×œ×¤×¨×˜×™× ×©×œ×š ---
    const USERNAME = 'dovi770'; 
    const REPO_NAME = 'meluket';    
    // ---------------------------------------------

    const apiUrl = `https://api.github.com/repos/${USERNAME}/${REPO_NAME}/releases?per_page=100`;

    // 1. ×©×œ×™×¤×ª ×”× ×ª×•× ×™×
    fetch(apiUrl)
    .then(res => {
        if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
        return res.json();
    })
    .then(releases => {
        document.getElementById('loader').style.display = 'none';
        const fileTree = buildFileTree(releases);
        renderTree(fileTree, document.getElementById('library-root'));
    })
    .catch(err => {
        document.getElementById('loader').innerHTML = `
            <div style="color:red; background:white; padding:20px; border-radius:8px;">
                âš ï¸ ×©×’×™××” ×‘×˜×¢×™× ×ª ×”× ×ª×•× ×™×.<br>
                <small>${err.message}</small><br>
                <small>× × ×œ×•×•×“× ×©×©× ×”××©×ª××© ×•×”×××’×¨ × ×›×•× ×™× ×‘×§×•×“.</small>
            </div>`;
        console.error(err);
    });

    // 2. ×‘× ×™×™×ª ×¢×¥ ×”×ª×™×§×™×•×ª
    function buildFileTree(releases) {
        const tree = {};
        releases.forEach(release => {
            // ×¤×™×¨×•×§ ×”×©× ×œ×¤×™ ××§×£
            const parts = release.name.split(' - ').map(s => s.trim());
            let current = tree;
            
            parts.forEach((part, index) => {
                if (!current[part]) {
                    if (index === parts.length - 1) {
                        current[part] = { type: 'files', data: release.assets };
                    } else {
                        current[part] = { type: 'folder', children: {} };
                    }
                }
                if (index < parts.length - 1) current = current[part].children;
            });
        });
        return tree;
    }

    // 3. ×”×¦×’×ª ×”×¢×¥ (HTML)
    function renderTree(node, container) {
        // ××™×•×Ÿ ×”××¤×ª×—×•×ª (×-×‘)
        const sortedKeys = Object.keys(node).sort((a, b) => a.localeCompare(b, 'he'));

        for (const key of sortedKeys) {
            const value = node[key];
            if (value.type === 'folder') {
                // ×™×¦×™×¨×ª ×ª×™×§×™×™×” ×¨××©×™×ª
                const folderDiv = document.createElement('div');
                folderDiv.className = 'folder-box';
                folderDiv.innerHTML = `
                    <div class="folder-header" onclick="toggleFolder(this)">
                        <div>ğŸ“‚ ${key}</div>
                        <span>â–¼</span>
                    </div>
                    <div class="folder-content"></div>
                `;
                renderTree(value.children, folderDiv.querySelector('.folder-content'));
                container.appendChild(folderDiv);
            } else {
                // ×™×¦×™×¨×ª ×ª×™×§×™×™×ª ×§×‘×¦×™× (×”×¨×™×œ×™×¡ ×¢×¦××•)
                const endFolder = document.createElement('div');
                endFolder.className = 'folder-box';
                endFolder.innerHTML = `
                    <div class="folder-header nested" onclick="toggleFolder(this)">
                        <div>ğŸ“€ ${key} <small style="opacity:0.6">(${value.data.length})</small></div>
                        <span>â–¼</span>
                    </div>
                    <div class="folder-content"></div>
                `;
                
                const filesContainer = endFolder.querySelector('.folder-content');
                let hasAudio = false;
                value.data.forEach(file => {
                    if (file.name.match(/\.(mp3|m4a|wav|ogg)$/i)) {
                        createPlayer(file, filesContainer);
                        hasAudio = true;
                    }
                });
                
                // ××¦×™×’ ×¨×§ ×× ×™×© ×§×‘×¦×™ ×©××¢
                if(hasAudio) container.appendChild(endFolder);
            }
        }
    }

    function toggleFolder(element) {
        const content = element.nextElementSibling;
        const icon = element.querySelector('span');
        
        if (content.classList.contains('show')) {
            content.classList.remove('show');
            icon.innerText = 'â–¼';
            element.style.background = ''; // ×—×–×¨×” ×œ×¦×‘×¢ ××§×•×¨×™
        } else {
            content.classList.add('show');
            icon.innerText = 'â–²';
            if(!element.classList.contains('nested')) {
               element.style.background = '#f0f2f5'; // ×”×“×’×©×” ×›×¤×ª×•×—
            }
        }
    }

    // 4. ×™×¦×™×¨×ª ×”× ×’×Ÿ ×”×—×›×
    function createPlayer(file, container) {
        const cleanName = file.name.replace(/\.[^/.]+$/, "").replace(/_/g, " ");
        const uniqueId = `audio_${file.id}`; 
        
        const div = document.createElement('div');
        div.className = 'file-card';
        div.innerHTML = `
            <span class="file-title">ğŸµ ${cleanName}</span>
            <audio id="${uniqueId}" controls preload="none">
                <source src="${file.browser_download_url}" type="audio/mpeg">
            </audio>
            <div class="controls">
                <button class="speed-btn active" onclick="setSpeed('${uniqueId}', 1, this)">1x</button>
                <button class="speed-btn" onclick="setSpeed('${uniqueId}', 1.25, this)">1.25</button>
                <button class="speed-btn" onclick="setSpeed('${uniqueId}', 1.5, this)">1.5</button>
                <button class="speed-btn" onclick="setSpeed('${uniqueId}', 2, this)">2x</button>
                
                <a href="${file.browser_download_url}" download class="download-btn">
                   â¬‡ ×”×•×¨×“×”
                </a>
            </div>
            <div style="margin-top:5px;"><span id="msg_${uniqueId}" class="resume-msg">ğŸ“Œ ×××©×™×š ××”× ×§×•×“×” ×”××—×¨×•× ×”</span></div>
        `;
        container.appendChild(div);

        // ×œ×•×’×™×§×” ×©×œ ×©××™×¨×ª ××™×§×•×
        const audio = div.querySelector('audio');
        
        audio.onloadedmetadata = () => {
            const saved = localStorage.getItem(uniqueId);
            if(saved && saved > 0) {
                audio.currentTime = saved;
                const msg = document.getElementById(`msg_${uniqueId}`);
                msg.style.display = 'inline-block';
                setTimeout(() => msg.style.display = 'none', 5000);
            }
        };

        audio.ontimeupdate = () => {
            if(!audio.paused) localStorage.setItem(uniqueId, audio.currentTime);
        };
    }

    window.setSpeed = function(id, rate, btn) {
        const audio = document.getElementById(id);
        audio.playbackRate = rate;
        
        const allBtns = btn.parentElement.querySelectorAll('.speed-btn');
        allBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
    }
</script>

</body>
</html>
